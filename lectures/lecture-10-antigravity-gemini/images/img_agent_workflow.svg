<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1300 600">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <marker id="arrowhead-rev" markerWidth="10" markerHeight="7" refX="1" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" fill="#333" />
    </marker>
  </defs>

  <!-- Agent System Subgraph Box -->
  <!-- Spans from before Plan (240) to after Verify (1000). -->
  <!-- Left: 180. Right: 1040. Top: 10. Bottom: 540. -->
  <rect x="180" y="10" width="880" height="540" rx="15" ry="15" fill="#fcfcfc" stroke="#666" stroke-width="2" stroke-dasharray="8,4" />
  <text x="620" y="40" text-anchor="middle" font-family="sans-serif" font-size="20" font-weight="bold" fill="#444">Agent System</text>

  <!-- Nodes -->
  
  <!-- User (Circle) -->
  <circle cx="80" cy="300" r="45" fill="#fff" stroke="#333" stroke-width="2" />
  <text x="80" y="305" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="bold">User</text>

  <!-- Memory (Database shape) -->
  <!-- Center: 520, 120. (Aligned with Confirm) -->
  <path d="M460 120 v60 a60,15 0 0 0 120,0 v-60" fill="#ffe6f2" stroke="#333" stroke-width="2" />
  <ellipse cx="520" cy="120" rx="60" ry="15" fill="#ffe6f2" stroke="#333" stroke-width="2" />
  <text x="520" y="155" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="bold">Memory</text>
  <text x="520" y="175" text-anchor="middle" font-family="sans-serif" font-size="12" fill="#555">(기억/맥락)</text>

  <!-- Plan (Rect) -->
  <!-- Center: 310. x=240. w=140. Right=380. -->
  <rect x="240" y="270" width="140" height="60" rx="8" ry="8" fill="#e6f2ff" stroke="#333" stroke-width="2" />
  <text x="310" y="300" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="bold">Planning</text>
  <text x="310" y="320" text-anchor="middle" font-family="sans-serif" font-size="12" fill="#555">(계획 수립)</text>

  <!-- Confirm (Rhombus) -->
  <!-- Center: 520. Width 120. Left=460. Right=580. -->
  <polygon points="520,250 580,300 520,350 460,300" fill="#fff" stroke="#333" stroke-width="2" />
  <text x="520" y="295" text-anchor="middle" font-family="sans-serif" font-size="14" font-weight="bold">Confirm</text>
  <text x="520" y="315" text-anchor="middle" font-family="sans-serif" font-size="12" fill="#555">(사용자 확인)</text>

  <!-- Exec (Rect) -->
  <!-- Center: 730. Width 140. Left=660. Right=800. -->
  <rect x="660" y="270" width="140" height="60" rx="8" ry="8" fill="#e6ffe6" stroke="#333" stroke-width="2" />
  <text x="730" y="300" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="bold">Execution</text>
  <text x="730" y="320" text-anchor="middle" font-family="sans-serif" font-size="12" fill="#555">(도구 실행)</text>

  <!-- Tools (Rect) -->
  <!-- Center: 730. -->
  <rect x="680" y="440" width="100" height="50" rx="4" ry="4" fill="#f0f0f0" stroke="#333" stroke-width="2" />
  <text x="730" y="470" text-anchor="middle" font-family="sans-serif" font-size="16" font-weight="bold">Tools</text>

  <!-- Verify (Rhombus) -->
  <!-- Center: 940. Width 120. Left=880. Right=1000. -->
  <polygon points="940,250 1000,300 940,350 880,300" fill="#fff" stroke="#333" stroke-width="2" />
  <text x="940" y="295" text-anchor="middle" font-family="sans-serif" font-size="14" font-weight="bold">Verify</text>
  <text x="940" y="315" text-anchor="middle" font-family="sans-serif" font-size="12" fill="#555">(검증)</text>

  <!-- Done (Circle) -->
  <!-- Center: 1150. Left Edge: 1115. -->
  <circle cx="1150" cy="300" r="35" fill="#fff" stroke="#333" stroke-width="2" />
  <circle cx="1150" cy="300" r="28" fill="none" stroke="#333" stroke-width="1" />
  <text x="1150" y="305" text-anchor="middle" font-family="sans-serif" font-size="14" font-weight="bold">Done</text>


  <!-- Edges with Balanced Lengths -->

  <!-- User (125,300) -> Plan (240,300) -->
  <line x1="128" y1="300" x2="230" y2="300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <rect x="145" y="285" width="80" height="20" fill="#fff" fill-opacity="0.8" />
  <text x="185" y="298" text-anchor="middle" font-family="sans-serif" font-size="12">1. 요구사항</text>

  <!-- Plan Top (310,270) <-> Memory Left (460,150 approx) -->
  <path d="M310 260 Q 310 150 450 150" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" marker-start="url(#arrowhead-rev)" />

  <!-- Plan Right (380,300) -> Confirm Left (460,300) -->
  <!-- Gap is 80px. Arrow length ~70px. -->
  <line x1="383" y1="300" x2="450" y2="300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="420" y="290" text-anchor="middle" font-family="sans-serif" font-size="12">2. 제안</text>

  <!-- Confirm Bottom (520,350) -> Plan Bottom (310,330) -->
  <path d="M520 353 C 520 420, 310 420, 310 340" fill="none" stroke="#d66" stroke-width="2" marker-end="url(#arrowhead)" />
  <rect x="380" y="405" width="70" height="20" fill="#f9f9f9" fill-opacity="0.9" />
  <text x="415" y="419" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#d44">피드백/수정</text>

  <!-- Confirm Right (580,300) -> Exec Left (660,300) -->
  <!-- Gap is 80px. Arrow length ~70px. -->
  <line x1="583" y1="300" x2="650" y2="300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="620" y="290" text-anchor="middle" font-family="sans-serif" font-size="12">3. 승인</text>

  <!-- Exec Top (730,270) <-> Memory Right (580,150 approx) -->
  <path d="M730 260 Q 730 150 590 150" fill="none" stroke="#999" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" marker-start="url(#arrowhead-rev)" />

  <!-- Exec Bottom (730,330) <-> Tools Top (730,440) -->
  <line x1="730" y1="333" x2="730" y2="430" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" marker-start="url(#arrowhead-rev)" />
  <rect x="735" y="370" width="70" height="20" fill="#fff" fill-opacity="0.8" />
  <text x="770" y="385" text-anchor="middle" font-family="sans-serif" font-size="12">4. 도구 사용</text>

  <!-- Exec Right (800,300) -> Verify Left (880,300) -->
  <!-- Gap is 80px. Arrow length ~70px. -->
  <line x1="803" y1="300" x2="870" y2="300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="840" y="290" text-anchor="middle" font-family="sans-serif" font-size="12">5. 검증</text>

  <!-- Verify Top (940,250) -> Plan Top (310,270) -->
  <path d="M940 250 C 940 70, 310 70, 310 260" fill="none" stroke="#d66" stroke-width="2" marker-end="url(#arrowhead)" />
  <rect x="600" y="75" width="80" height="20" fill="#f9f9f9" fill-opacity="0.9" />
  <text x="640" y="89" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#d44">실패 (재수립)</text>

  <!-- Verify Right (1000,300) -> Done Left (1115,300) -->
  <line x1="1003" y1="300" x2="1105" y2="300" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" />
  <text x="1055" y="290" text-anchor="middle" font-family="sans-serif" font-size="12">6. 성공</text>

</svg>
